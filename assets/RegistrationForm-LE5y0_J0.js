import{j as e}from"./iframe-Bt4UvEqW.js";import{u as j}from"./index.esm-ClsO7imu.js";import{V as v,c as u,d as b,a as y}from"./index-BlSK3dwA.js";import{v as N}from"./v4-BKrj-4V8.js";import{B as S}from"./Button-40eEdaHr.js";import{u as P}from"./ButtonNavigation-DuwpFPZD.js";import"./Dropdown-D_2yar06.js";import"./FilePicker-D62rdBOg.js";import{I as p}from"./Input-Bygz4nLz.js";import"./Like-DXxARhTn.js";import"./Loader-ld3rHLDK.js";import"./index-DfYkHRSD.js";import"./PageLoader-HUM1dPua.js";import"./PageWrapper-Nh9y5AVa.js";import"./ConfirmDeleteModal-BXHaXOST.js";import{T as n}from"./Text-IhfjRFJQ.js";import"./TrackControlButton-DKEqXBy9.js";import"./UserAvatar-B3tKy1se.js";import{u as k}from"./useTranslation-D6XLV_9q.js";const q=async t=>v.promise((async()=>{if((await u.get("/users",{params:{email:t.email}})).data.length>0)throw new Error("Пользователь с таким email уже существует");const d=b.genSaltSync(10),o=b.hashSync(t.password,d),l={id:N(),email:t.email,password:o,avatar:"",username:"",createdAt:new Date().toISOString()},r=await u.post("/users",l);if(!r.data)throw new Error("Empty response");const a=y.getState().setAuthData;return a(r.data),r.data})(),{loading:"Регистрация...",success:"Вы успешно зарегистрировались",error:s=>s instanceof Error?s.message:"Ошибка при регистрации"}).catch(()=>null),Q=({onSuccess:t})=>{const{t:s}=k("registration"),d=P(),{register:o,handleSubmit:l,formState:{errors:r,isSubmitting:a,isSubmitted:c},trigger:m,watch:w}=j({mode:"onSubmit"}),x=w("password",""),f=async({email:i,password:h})=>{await q({email:i,password:h})&&(t(),d("/main"))},g=i=>{l(f)(i)};return e.jsxs("form",{onSubmit:g,className:"",autoComplete:"off",noValidate:!0,children:[e.jsx(n,{title:s("title")}),e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{className:"block mb-2 font-semibold text-black text-lg",text:s("email.label")}),e.jsx(p,{id:"email",type:"email",...o("email",{required:s("email.required"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:s("email.invalid")}}),disabled:a,placeholder:"you@example.com",className:r.email?"border-red-500":"border-gray-300",onChange:()=>{c&&m("email")}}),r.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.email.message})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{className:"block mb-2 font-semibold text-black text-lg",text:s("password.label")}),e.jsx(p,{id:"password",type:"password",...o("password",{required:s("password.required"),minLength:{value:6,message:s("password.minLength")}}),disabled:a,placeholder:"••••••",className:r.password?"border-red-500":"border-gray-300",onChange:()=>{c&&(m("password"),m("confirmPassword"))}}),r.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.password.message})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx(n,{className:"block mb-2 font-semibold text-black text-lg",text:s("confirmPassword.label")}),e.jsx(p,{id:"confirmPassword",type:"password",...o("confirmPassword",{required:s("confirmPassword.required"),validate:i=>i===x||s("confirmPassword.match")}),disabled:a,placeholder:"••••••",className:r.confirmPassword?"border-red-500":"border-gray-300",onChange:()=>{c&&m("confirmPassword")}}),r.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.confirmPassword.message})]}),e.jsx(S,{type:"submit",disabled:a,className:"w-full",children:s("submit")})]})};export{Q as R};
