import{r as p,u as E,j as r}from"./iframe-CCPG9B4X.js";import{u as G,C as v}from"./index.esm-CgPSDXYN.js";import{R as L}from"./ButtonNavigation-BxvL78nb.js";import{c as z,V as I,g as b,e as R,a as T}from"./ConfirmDeleteModal-D2XLBDl3.js";import{v as y}from"./v4-BKrj-4V8.js";import{B as j,a as F,b as U}from"./Button-Bbd_4dKP.js";import"./Dropdown-xaWiqvUd.js";import"./FilePicker-C-0viexR.js";import{I as C}from"./Input-CrW3eORU.js";import"./Like-B-_46ITe.js";import"./Loader-C1jWAQqW.js";import"./index-CBrGr1YP.js";import"./PageLoader-CcW8yQkr.js";import"./PageWrapper-B_RLjTmo.js";import{T as l}from"./Text-BdjnsNMI.js";import"./TrackControlButton-OZ2XJtMV.js";import"./UserAvatar-DMAIqh6G.js";import{g as q}from"./group-CAN1cVaR.js";import{u as A}from"./useTranslation-CGIo-ki9.js";const B=async o=>{const a=z.getState().authData;if(!a)throw new Error("Пользователь не авторизован");return await I.promise((async()=>{if(!o.icon?.[0])throw new Error("Иконка обязательна");const{data:n}=await b.get("/groups",{params:{name:o.name}});if(n.length>0)throw new Error("Группа с таким названием уже существует");const s=new FormData;s.append("groupName",o.name),s.append("icon",o.icon[0]);const d=(await R.post("/uploadGroupCover",s,{headers:{"Content-Type":"multipart/form-data"}})).data.url,i=y(),x=new Date().toISOString(),m={id:i,name:o.name,description:o.description??"",userId:a.id,genre:o.genre??"Рок",cover:d,createdAt:x,updatedAt:""},{data:e}=await b.post("/groups",m);if(!e)throw new Error("Ошибка при создании группы");await b.patch(`/users/${a.id}`,{id:i});const t={id:y(),name:e.name,description:e.description??"",cover:e.cover,userId:e.userId,genre:e.genre,createdAt:e.createdAt,updatedAt:""};return T.getState().setCurrentGroup(t),t})(),{loading:"Создание группы...",success:"Группа успешно создана",error:n=>n instanceof Error?n.message:"Ошибка при создании группы"})};function H(){const[o,a]=p.useState(null),[n,s]=p.useState(!1),[g,d]=p.useState([]),{control:i,register:x,handleSubmit:m,watch:e,reset:t,setValue:c,formState:{errors:h,isSubmitting:N}}=G({defaultValues:{name:"",description:"",icon:null,genre:void 0}}),w=e("icon"),f=p.useCallback(()=>s(window.innerHeight<600),[]);p.useEffect(()=>(f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)),[f]),p.useEffect(()=>{if(w?.length){const u=URL.createObjectURL(w[0]);return a(u),()=>URL.revokeObjectURL(u)}a(null)},[w]);const S=async u=>{await B(u)&&(t(),a(null),u.genre!==void 0&&d(k=>[...k,u.genre]))};return{control:i,register:x,handleSubmit:m,watch:e,reset:t,errors:h,isSubmitting:N,preview:o,setValue:c,isHorizontal:n,createdGenres:g,handleIconClick:()=>document.getElementById("icon-upload")?.click(),handleSubmitForm:()=>void m(S)()}}const ie=()=>{const o=E(t=>t.theme),{control:a,register:n,errors:s,isSubmitting:g,isHorizontal:d,preview:i,handleIconClick:x,handleSubmitForm:m}=H(),{t:e}=A("createGroupForm");return r.jsxs("form",{onSubmit:t=>{t.preventDefault(),m()},className:`
                flex
                ${d?"flex-row":"flex-col"}
                gap-6
                w-full
                max-w-4xl
                p-6
                rounded-lg
                max-h-[80vh]
                overflow-hidden
            `,children:[r.jsx("div",{className:`
                    flex-shrink-0 flex justify-center items-center rounded-md border-2 border-dashed cursor-pointer
                    max-w-32 max-h-32
                    transition-colors
                    ${d?"":"mx-auto"}
                `,style:{borderColor:o["--primary-color"]||"#880015",color:o["--primary-color"]||"#880015",width:i?"auto":"6rem",height:i?"auto":"6rem"},title:e("icon.title"),onMouseEnter:t=>{t.currentTarget.style.backgroundColor=o["--primary-color"]||"#880015",t.currentTarget.style.color="#fff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="transparent",t.currentTarget.style.color=o["--primary-color"]||"#880015"},onClick:x,children:i?r.jsx("img",{src:i,alt:e("icon.alt"),className:"rounded-md object-contain",style:{maxWidth:"100%",maxHeight:"100%"}}):r.jsx(L,{size:48,className:"sm:w-28 sm:h-28 md:w-32 md:h-32"})}),r.jsxs("div",{className:"flex flex-col flex-1 overflow-y-auto",style:{maxHeight:"80vh",minWidth:0},children:[r.jsx(v,{control:a,name:"icon",rules:{required:e("validation.iconRequired")},render:({field:t})=>r.jsx("input",{id:"icon-upload",type:"file",accept:"image/*",className:"hidden",onChange:c=>t.onChange(c.target.files)})}),s.icon&&r.jsx(l,{className:"text-red-500 text-sm text-center mb-2",children:s.icon.message}),r.jsx(l,{title:e("title"),className:"mb-4"}),r.jsx(l,{text:e("name.label"),className:"text-white",size:"medium"}),r.jsx(C,{...n("name",{required:e("validation.nameRequired"),maxLength:{value:50,message:e("validation.nameMax")}}),placeholder:e("name.placeholder"),className:"bg-gray-700 border-gray-600 min-w-0 w-full mb-1"}),s.name&&r.jsx(l,{className:"text-red-500 text-sm mb-3",children:s.name.message}),r.jsx(l,{text:e("description.label"),className:"text-white mt-2",size:"medium"}),r.jsx(C,{...n("description",{maxLength:{value:200,message:e("validation.descriptionMax")}}),placeholder:e("description.placeholder"),className:"p-2 rounded bg-gray-700 border border-gray-600 text-white resize-none focus:outline-none focus:border-pink-600 min-w-0 w-full mb-4"}),s.description&&r.jsx(l,{className:"text-red-500 text-sm mb-4",children:s.description.message}),r.jsx(l,{text:e("genre.label"),className:"text-white mb-2",size:"medium"}),r.jsx(v,{control:a,name:"genre",rules:{required:e("validation.genreRequired")},render:({field:t})=>r.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:q.map(c=>{const h=t.value===c;return r.jsx(j,{type:"button",onClick:()=>t.onChange(c),className:`
                                            transition-colors border rounded px-3 py-1 cursor-pointer select-none
                                            ${h?"text-white":"text-gray-300 hover:text-white"}
                                        `,style:{backgroundColor:h?o["--primary-color"]:"#2d2d2d",borderColor:h?o["--primary-color"]:"#4b5563"},children:c},c)})})}),s.genre&&r.jsx(l,{className:"text-red-500 text-sm mb-4",children:s.genre.message}),r.jsx(j,{type:"submit",disabled:g,theme:U.OUTLINE,size:F.L,className:"self-center",onClick:m,children:e("submit")})]})]})};export{ie as C};
