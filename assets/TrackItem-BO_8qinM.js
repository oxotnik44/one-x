import{j as o,r as m,u as M}from"./iframe-U8ya4lKj.js";import{G as B}from"./iconBase--zlYJr49.js";import{B as T,b as U}from"./Button-DE9W436l.js";import"./ButtonNavigation-COrRjsTF.js";import{D as G}from"./Dropdown-DwKt7Qhu.js";import"./FilePicker-CbYA0TGi.js";import{u as A}from"./GroupCover-BGBq_pSL.js";import"./Input-DaFUx77P.js";import{L as V}from"./Like-B3pHqG2f.js";import"./Loader-DiHYOjMw.js";import"./index-C84dbosL.js";import"./PageLoader-DRYwdG-o.js";import"./PageWrapper-CGXxUwgW.js";import{P as F}from"./PlayButton-DHaq6iyc.js";import{T as j}from"./Text-DVKAWUAM.js";import"./TrackControlButton-9SyhFgiT.js";import"./UserAvatar-QfRyJ_rf.js";import{M as H}from"./Modal-4746e8Vq.js";import{u as D}from"./useTranslation-CSTQQmYg.js";import{u as k,l as J,f as W}from"./usePlayerStore-DnPMUqle.js";import{u as q}from"./index-DSF9hKFK.js";import{V as g,a as N,b as y}from"./api-BNB6Hzxt.js";import{u as I}from"./useAlbumStore-2sgAmzBL.js";import{u as O}from"./useTrackStore-OiNvfdpV.js";const K=({isOpen:e,onClose:s,onConfirm:n})=>{const{t:r}=D("confirmDeleteModal");return o.jsx(H,{isOpen:e,onClose:s,closable:!0,children:o.jsxs("div",{className:"flex flex-col gap-4 min-w-[300px]",children:[o.jsx(j,{className:"text-lg font-semibold text-white",children:r("confirmDelete")}),o.jsxs("div",{className:"flex justify-center gap-10",children:[o.jsx(T,{onClick:s,children:r("cancel")}),o.jsx(T,{onClick:n,children:r("delete")})]})]})})};function Q(e){return B({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"},child:[]}]})(e)}async function X(e,s,n,r){if(!n||!r){g.error("Ошибка: группа или альбом не выбраны");return}const c=n.name,p=r.name,a=r.trackIds.filter(i=>i!==e);try{await Promise.all([N.delete(`/deleteTrack/${encodeURIComponent(c)}/${encodeURIComponent(p)}/${encodeURIComponent(s)}`),y.delete(`/tracks/${e}`),y.patch(`/albums/${r.id}`,{trackIds:a})]);const{tracks:i,setTracks:d}=O.getState();d(i.filter(l=>l.id!==e));const{albums:u,setAlbums:h}=I.getState(),x=u.map(l=>l.id===r.id?{...l,trackIds:a}:l);h(x),g.success(`Трек "${s}" успешно удалён из альбома "${p}"`)}catch(i){g.error(i instanceof Error?i.message:"Ошибка при удалении трека")}}const Y=async(e,s,n)=>{try{await Promise.all([N.delete(`/deleteTrack/${encodeURIComponent(e)}/${encodeURIComponent(s)}`),y.delete(`/tracks/${n}`)]),O.getState().removeTrack(n),g.success(`Трек "${s}" успешно удалён!`)}catch(r){console.error(r),g.error(r instanceof Error?r.message:"Ошибка при удалении трека")}};function Z({track:e,groupName:s,onConfirmDelete:n}){const[r,c]=m.useState(!1),[p,a]=m.useState(!1),i=m.useRef(null),d=A(t=>t.currentGroup),u=I(t=>t.currentAlbum),h=k(t=>t.currentTrack?.id),x=k(t=>t.isPlaying),l=k(t=>t.togglePlay),C=k(t=>t.setCurrentTrack),v=q(t=>t.authData),w=M(t=>t.theme),f=h===e.id,b=f&&x,P=!!v?.likedTracks?.includes(e.id),S=m.useCallback(()=>{f?l():C(e)},[f,C,e,l]),$=m.useCallback(()=>J(e.id),[e.id]),L=m.useCallback(()=>c(t=>!t),[]);m.useEffect(()=>{const t=E=>{i.current&&!i.current.contains(E.target)&&c(!1)};return r&&document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[r]);const R=()=>{c(!1),a(!1),setTimeout(()=>a(!0),0)},z=m.useCallback(async()=>{a(!1);try{if(!e.albumId)await Y(s,e.title,e.id);else{if(!d||!u)return;await X(e.id,e.title,d,u)}n?.(e)}catch(t){console.error(t)}},[e,s,d,u,n]);return{isDropdownOpen:r,isConfirmOpen:p,modalRef:i,theme:w,liked:P,isPlaying:b,isCurrent:f,onPlayClick:S,toggleLike:$,toggleDropdown:L,onDeleteClick:R,onConfirmDeleteClick:z,setConfirmOpen:a,setDropdownOpen:c}}const _=({track:e,groupName:s,onConfirmDelete:n})=>{const{isDropdownOpen:r,isConfirmOpen:c,modalRef:p,theme:a,liked:i,isPlaying:d,isCurrent:u,onPlayClick:h,toggleLike:x,toggleDropdown:l,onDeleteClick:C,setDropdownOpen:v,onConfirmDeleteClick:w,setConfirmOpen:f}=Z({track:e,groupName:s,onConfirmDelete:n}),{t:b}=D("trackItem");return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex w-full max-w-full items-center border rounded overflow-hidden",style:{backgroundColor:"var(--bg-container)"},children:[o.jsxs("div",{className:"relative w-20 h-20 flex-shrink-0",children:[o.jsx("img",{loading:"lazy",width:80,height:80,src:e.cover,alt:e.title,className:"object-cover rounded-tr-lg rounded-br-lg"}),o.jsx("div",{className:"absolute inset-0 bg-black/0 hover:bg-black/50 transition-colors flex items-center justify-center rounded-tr-lg rounded-br-lg",children:o.jsx(F,{isPlaying:d,isCurrent:u,onClick:h,theme:U.CLEAR,showOnHover:!0})})]}),o.jsxs("div",{className:"flex flex-col justify-center flex-grow px-4 overflow-hidden",children:[o.jsx(j,{size:"medium",className:"truncate",children:s}),o.jsx(j,{size:"medium",className:"truncate font-semibold",children:e.title})]}),o.jsxs("div",{className:"flex gap-5 items-center px-4 min-w-[60px] relative",children:[o.jsx(V,{liked:i,onToggle:x}),o.jsx(j,{size:"small",children:W(e.duration)}),o.jsx("button",{className:"p-1 rounded-full border border-white hover:border-gray-300 hover:text-black text-gray-500 transition-colors cursor-pointer",onClick:l,children:o.jsx(Q,{size:20,color:a["--primary-color"]})}),o.jsxs(G,{isOpen:r,onClose:()=>v(!1),className:"ml-30 mb-35 min-w-[120px]",ref:p,children:[o.jsx("div",{className:"text-sm cursor-pointer hover:bg-gray-100 rounded p-2",onClick:C,children:b("delete")}),o.jsx("div",{className:"text-sm cursor-pointer hover:bg-gray-100 rounded p-2",children:b("option2")})]})]})]}),o.jsx(K,{isOpen:c,onClose:()=>f(!1),onConfirm:w})]})};_.displayName="TrackItem";export{K as C,_ as T};
