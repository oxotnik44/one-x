import{j as e}from"./iframe-C0kfoYRU.js";import{u as j}from"./index.esm-CVV88-oh.js";import{V as v,g as u,j as w,c as y}from"./AutoHideScroll-Bn4kiatZ.js";import{v as N}from"./v4-BKrj-4V8.js";import{B as S}from"./Button-BG29j6-m.js";import{u as P}from"./ButtonNavigation-AGHQnJJF.js";import"./Dropdown-B0nLrr0u.js";import"./FilePicker-BOxeBJkN.js";import{I as p}from"./Input-Syt8WR94.js";import"./Like-CU83MUjH.js";import"./Loader-BA1QRYy5.js";import"./index-CCh5LiNu.js";import"./PageLoader-CjR7aYj7.js";import"./PageWrapper-CUwEEPPt.js";import{T as l}from"./Text-Cv_jbED3.js";import"./TrackControlButton-Cp9njBny.js";import"./UserAvatar-D3VV5S8d.js";import{u as k}from"./useTranslation-DTQxaVaH.js";const q=async a=>v.promise((async()=>{if((await u.get("/users",{params:{email:a.email}})).data.length>0)throw new Error("Пользователь с таким email уже существует");const c=w.genSaltSync(10),o=w.hashSync(a.password,c),n={id:N(),email:a.email,password:o,avatar:"",username:"",createdAt:new Date().toISOString()},r=await u.post("/users",n);if(!r.data)throw new Error("Empty response");const t=encodeURIComponent(JSON.stringify({id:n.id,email:a.email,password:a.password}));document.cookie=`user=${t}; path=/; max-age=${10080*60}`;const i=y.getState().setAuthData;return i(r.data),r.data})(),{loading:"Регистрация...",success:"Вы успешно зарегистрировались",error:s=>s instanceof Error?s.message:"Ошибка при регистрации"}).catch(()=>null),Q=({onSuccess:a})=>{const{t:s}=k("registration"),c=P(),{register:o,handleSubmit:n,formState:{errors:r,isSubmitting:t,isSubmitted:i},trigger:d,watch:b}=j({mode:"onSubmit"}),x=b("password",""),g=async({email:m,password:h})=>{await q({email:m,password:h})&&(a(),c("/main"))},f=m=>{n(g)(m)};return e.jsxs("form",{onSubmit:f,className:"",autoComplete:"off",noValidate:!0,children:[e.jsx(l,{title:s("title")}),e.jsxs("div",{className:"mb-6",children:[e.jsx(l,{className:"block mb-2 font-semibold text-black text-lg",text:s("email.label")}),e.jsx(p,{id:"email",type:"email",...o("email",{required:s("email.required"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:s("email.invalid")}}),disabled:t,placeholder:"you@example.com",className:r.email?"border-red-500":"border-gray-300",onChange:()=>{i&&d("email")}}),r.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.email.message})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(l,{className:"block mb-2 font-semibold text-black text-lg",text:s("password.label")}),e.jsx(p,{id:"password",type:"password",...o("password",{required:s("password.required"),minLength:{value:6,message:s("password.minLength")}}),disabled:t,placeholder:"••••••",className:r.password?"border-red-500":"border-gray-300",onChange:()=>{i&&(d("password"),d("confirmPassword"))}}),r.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.password.message})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx(l,{className:"block mb-2 font-semibold text-black text-lg",text:s("confirmPassword.label")}),e.jsx(p,{id:"confirmPassword",type:"password",...o("confirmPassword",{required:s("confirmPassword.required"),validate:m=>m===x||s("confirmPassword.match")}),disabled:t,placeholder:"••••••",className:r.confirmPassword?"border-red-500":"border-gray-300",onChange:()=>{i&&d("confirmPassword")}}),r.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.confirmPassword.message})]}),e.jsx(S,{type:"submit",disabled:t,className:"w-full",children:s("submit")})]})};export{Q as R};
