import{r as g,j as s}from"./iframe-CCPG9B4X.js";import{u as S}from"./index.esm-CgPSDXYN.js";import{V as y,g as N,i as v,c as E}from"./ConfirmDeleteModal-D2XLBDl3.js";import{B as k}from"./Button-Bbd_4dKP.js";import{u as C}from"./ButtonNavigation-BxvL78nb.js";import"./Dropdown-xaWiqvUd.js";import"./FilePicker-C-0viexR.js";import{I as x}from"./Input-CrW3eORU.js";import"./Like-B-_46ITe.js";import"./Loader-C1jWAQqW.js";import"./index-CBrGr1YP.js";import"./PageLoader-CcW8yQkr.js";import"./PageWrapper-B_RLjTmo.js";import{T as i}from"./Text-BdjnsNMI.js";import"./TrackControlButton-OZ2XJtMV.js";import"./UserAvatar-DMAIqh6G.js";import{u as V}from"./useTranslation-CGIo-ki9.js";const q=async o=>y.promise((async()=>{const e=await N.get("/users",{params:{email:o.email}});if(!e.data||e.data.length===0)throw new Error("Пользователь с таким email не найден");const r=e.data[0];if(!v.compareSync(o.password,r.password))throw new Error("Неверный пароль");const l=E.getState().setAuthData;l(r);const a=encodeURIComponent(JSON.stringify({id:r.id,email:r.email,password:o.password}));return document.cookie=`user=${a}; path=/; max-age=${10080*60}`,r})(),{loading:"Вход в систему...",success:"Вы успешно вошли",error:e=>e instanceof Error?e.message:"Ошибка при входе в систему"}).catch(()=>null),M=({onSuccess:o})=>{const{t:e}=V("loginForm"),r=C(),{register:m,handleSubmit:l,formState:{errors:a,isSubmitting:n,isSubmitted:d},trigger:c}=S({mode:"onSubmit"}),[p,b]=g.useState(""),[u,w]=g.useState(""),f=t=>{b(t),d&&c("email")},h=t=>{w(t),d&&c("password")},j=async()=>{await q({email:p,password:u})&&(o(),r("/main"))};return s.jsxs("form",{onSubmit:t=>{l(j)(t)},autoComplete:"off",noValidate:!0,children:[s.jsx(i,{title:e("title")}),s.jsxs("div",{className:"mb-6",children:[s.jsx(i,{className:"block mb-2 font-semibold text-black text-lg",text:e("email.label")}),s.jsx(x,{id:"email",type:"email",...m("email",{required:e("email.required"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:e("email.invalid")}}),value:p,onChangeHandler:f,disabled:n,placeholder:e("email.placeholder"),className:a.email?"border-red-500":"border-gray-300"}),a.email&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.email.message})]}),s.jsxs("div",{className:"mb-8",children:[s.jsx(i,{className:"block mb-2 font-semibold text-black text-lg",text:e("password.label")}),s.jsx(x,{id:"password",type:"password",...m("password",{required:e("password.required"),minLength:{value:6,message:e("password.minLength")}}),value:u,onChangeHandler:h,disabled:n,placeholder:e("password.placeholder"),className:a.password?"border-red-500":"border-gray-300"}),a.password&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.password.message})]}),s.jsx(k,{type:"submit",disabled:n,className:"w-full",children:s.jsx(i,{text:e("submit")})})]})};export{M as L};
