import{r as g,u as v,j as e}from"./iframe-U8ya4lKj.js";import{u as y,C as j}from"./index.esm-BbXu7aDV.js";import{u as w,G as C}from"./GroupCover-BGBq_pSL.js";import{V as N,a as S,b as G}from"./api-BNB6Hzxt.js";import{g as E}from"./group-CAN1cVaR.js";import"./index-DSF9hKFK.js";import{B as f,a as I,b as z}from"./Button-DE9W436l.js";import{u as F}from"./ButtonNavigation-COrRjsTF.js";import"./Dropdown-DwKt7Qhu.js";import"./FilePicker-CbYA0TGi.js";import{I as b}from"./Input-DaFUx77P.js";import"./Like-B3pHqG2f.js";import"./Loader-DiHYOjMw.js";import"./index-C84dbosL.js";import"./PageLoader-DRYwdG-o.js";import"./PageWrapper-CGXxUwgW.js";import"./PlayButton-DHaq6iyc.js";import{T as l}from"./Text-DVKAWUAM.js";import"./TrackControlButton-9SyhFgiT.js";import"./UserAvatar-QfRyJ_rf.js";import{u as L}from"./useTranslation-CSTQQmYg.js";const T=async(r,a)=>{if(!r)throw new Error("ID группы не указан");return N.promise((async()=>{let s=a.cover;if(a.newIconFile?.[0]){const o=new FormData;o.append("groupName",a.name),o.append("icon",a.newIconFile[0]);const{data:u}=await S.post("/uploadGroupCover",o,{headers:{"Content-Type":"multipart/form-data"}});s=u.url}const i={name:a.name,description:a.description??null,genre:a.genre,cover:s,updatedAt:new Date().toISOString()},{data:m}=await G.patch(`/groups/${r}`,i);if(!m)throw new Error("Ошибка при обновлении группы");return w.getState().setCurrentGroup(m),m})(),{loading:"Сохраняем изменения...",success:"Группа успешно обновлена",error:s=>s instanceof Error?s.message:"Ошибка при обновлении группы"})},k=()=>{const r=w(t=>t.currentGroup),[a,s]=g.useState(null),{control:i,register:m,setValue:o,handleSubmit:u,watch:p,formState:{errors:x,isSubmitting:n}}=y({defaultValues:{name:"",description:"",genre:"Рок",icon:null}});g.useEffect(()=>{r&&(o("name",r.name),o("description",r.description??""),o("genre",r.genre??"Рок"),s(r.cover??null),o("icon",null))},[r,o]);const h=t=>{t?.[0]?(s(URL.createObjectURL(t[0])),o("icon",t)):(s(null),o("icon",null))},c=u(async t=>{if(!r)return!1;try{return await T(r.id,{name:t.name,description:t.description??null,genre:t.genre,cover:r.cover,newIconFile:t.icon??null}),!0}catch(d){return console.error("Ошибка обновления группы",d),!1}});return{control:i,register:m,errors:x,isSubmitting:n,preview:a,handleIconChange:h,onSubmit:c,setValue:o,watch:p}},re=()=>{const r=v(c=>c.theme),{control:a,register:s,errors:i,isSubmitting:m,preview:o,handleIconChange:u,onSubmit:p}=k(),x=F(),{t:n}=L("editGroupForm"),h=()=>{p(),x("/my_group")};return e.jsxs("form",{className:"flex flex-col md:flex-row md:items-center md:justify-center gap-14 max-w-4xl p-6 rounded-lg max-h-[80vh] overflow-hidden mx-auto",children:[e.jsx(C,{edit:!0,preview:o,onIconChange:u}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-y-auto",style:{maxHeight:"80vh",minWidth:0},children:[e.jsx(l,{title:n("title"),className:"mb-4"}),e.jsx(l,{text:n("name.label"),size:"medium",className:"text-white"}),e.jsx(b,{...s("name",{required:n("name.required"),maxLength:{value:50,message:n("name.max")}}),placeholder:n("name.placeholder"),className:"bg-gray-700 border-gray-600 w-full min-w-0 mb-1"}),i.name&&e.jsx(l,{error:!0,size:"small",children:i.name.message}),e.jsx(l,{text:n("description.label"),size:"medium",className:"text-white mt-2"}),e.jsx(b,{...s("description",{maxLength:{value:200,message:n("description.max")}}),placeholder:n("description.placeholder"),className:"p-2 rounded bg-gray-700 border border-gray-600 text-white resize-none focus:outline-none focus:border-pink-600 w-full min-w-0 mb-4"}),i.description&&e.jsx(l,{error:!0,size:"small",children:i.description.message}),e.jsx(l,{text:n("genre.label"),size:"medium",className:"text-white mb-2"}),e.jsx(j,{control:a,name:"genre",rules:{required:n("genre.required")},render:({field:c})=>e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:E.map(t=>{const d=c.value===t;return e.jsx(f,{type:"button",onClick:()=>c.onChange(t),className:`transition-colors border rounded px-3 py-1 cursor-pointer select-none ${d?"text-white":"text-gray-300 hover:text-white"}`,style:{backgroundColor:d?r["--primary-color"]:"#2d2d2d",borderColor:d?r["--primary-color"]:"#4b5563"},children:t},t)})})}),i.genre&&e.jsx(l,{className:"text-red-500 text-sm mb-4",children:i.genre.message}),e.jsx(f,{type:"button",disabled:m,theme:z.OUTLINE,size:I.L,className:"self-center",onClick:h,children:n("submit")})]})]})};export{re as E};
