import{V as u,b as s}from"./api-BNB6Hzxt.js";import{u as n}from"./index-DSF9hKFK.js";import{c}from"./iframe-U8ya4lKj.js";const T=async e=>{const{authData:o,toggleLikeTrack:r}=n.getState();if(!o){u.error("Войдите, чтобы лайкать");return}const a=o.likedTracks??[],i=a.includes(e)?a.filter(t=>t!==e):[...a,e];try{const{data:t}=await s.patch(`/users/${o.id}`,{likedTracks:i});r(t.likedTracks??i),u.success(a.includes(e)?"💔 Убрано из избранного":"❤️ Добавлено в избранное")}catch{u.error("Не удалось обновить лайк")}},f=e=>{const o=Math.floor(e/60),r=Math.floor(e%60);return`${o}:${r.toString().padStart(2,"0")}`},p=c((e,o)=>({currentTrack:null,progress:0,currentTime:0,isPlaying:!1,duration:0,volume:1,isMuted:!1,audio:null,setCurrentTrack:r=>{const a=o();a.audio&&(a.audio.pause(),a.audio.src="");const i=new Audio(r.audioUrl);i.volume=a.isMuted?0:a.volume,i.addEventListener("loadedmetadata",()=>{e({duration:i.duration})}),i.addEventListener("timeupdate",()=>{e({progress:i.currentTime/i.duration*100,currentTime:i.currentTime})}),i.play().catch(()=>{console.warn("Автовоспроизведение запрещено браузером")}),e({currentTrack:r,progress:0,currentTime:0,isPlaying:!0,duration:0,audio:i})},setProgress:r=>{const a=o().audio;a&&(a.currentTime=r/100*a.duration),e({progress:r})},setCurrentTime:r=>e({currentTime:r}),setIsPlaying:r=>{const a=o().audio;a&&(r?a.play().catch(i=>{console.warn("Ошибка воспроизведения аудио:",i)}):a.pause(),e({isPlaying:r}))},setDuration:r=>e({duration:r}),setVolume:r=>{const a=o().audio;a&&(a.volume=r),e({volume:r})},setIsMuted:r=>{const a=o().audio;a&&(a.volume=r?0:o().volume),e({isMuted:r})},togglePlay:()=>{const{isPlaying:r,setIsPlaying:a}=o();a(!r)},resetPlayer:()=>{const r=o().audio;r&&r.pause(),e({currentTrack:null,progress:0,currentTime:0,isPlaying:!1,duration:0,audio:null})}}));export{f,T as l,p as u};
