import{j as e}from"./iframe-U8ya4lKj.js";import{u as j}from"./index.esm-BbXu7aDV.js";import{V as v,b as u}from"./api-BNB6Hzxt.js";import{b,u as y}from"./index-DSF9hKFK.js";import{v as N}from"./v4-BKrj-4V8.js";import{B as S}from"./Button-DE9W436l.js";import{u as P}from"./ButtonNavigation-COrRjsTF.js";import"./Dropdown-DwKt7Qhu.js";import"./FilePicker-CbYA0TGi.js";import"./GroupCover-BGBq_pSL.js";import{I as p}from"./Input-DaFUx77P.js";import"./Like-B3pHqG2f.js";import"./Loader-DiHYOjMw.js";import"./index-C84dbosL.js";import"./PageLoader-DRYwdG-o.js";import"./PageWrapper-CGXxUwgW.js";import"./PlayButton-DHaq6iyc.js";import{T as n}from"./Text-DVKAWUAM.js";import"./TrackControlButton-9SyhFgiT.js";import"./UserAvatar-QfRyJ_rf.js";import{u as k}from"./useTranslation-CSTQQmYg.js";const q=async t=>v.promise((async()=>{if((await u.get("/users",{params:{email:t.email}})).data.length>0)throw new Error("Пользователь с таким email уже существует");const d=b.genSaltSync(10),o=b.hashSync(t.password,d),l={id:N(),email:t.email,password:o,avatar:"",username:"",createdAt:new Date().toISOString()},r=await u.post("/users",l);if(!r.data)throw new Error("Empty response");const a=y.getState().setAuthData;return a(r.data),r.data})(),{loading:"Регистрация...",success:"Вы успешно зарегистрировались",error:s=>s instanceof Error?s.message:"Ошибка при регистрации"}).catch(()=>null),X=({onSuccess:t})=>{const{t:s}=k("registration"),d=P(),{register:o,handleSubmit:l,formState:{errors:r,isSubmitting:a,isSubmitted:c},trigger:m,watch:w}=j({mode:"onSubmit"}),x=w("password",""),f=async({email:i,password:h})=>{await q({email:i,password:h})&&(t(),d("/main"))},g=i=>{l(f)(i)};return e.jsxs("form",{onSubmit:g,className:"",autoComplete:"off",noValidate:!0,children:[e.jsx(n,{title:s("title")}),e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{className:"block mb-2 font-semibold text-black text-lg",text:s("email.label")}),e.jsx(p,{id:"email",type:"email",...o("email",{required:s("email.required"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:s("email.invalid")}}),disabled:a,placeholder:"you@example.com",className:r.email?"border-red-500":"border-gray-300",onChange:()=>{c&&m("email")}}),r.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.email.message})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(n,{className:"block mb-2 font-semibold text-black text-lg",text:s("password.label")}),e.jsx(p,{id:"password",type:"password",...o("password",{required:s("password.required"),minLength:{value:6,message:s("password.minLength")}}),disabled:a,placeholder:"••••••",className:r.password?"border-red-500":"border-gray-300",onChange:()=>{c&&(m("password"),m("confirmPassword"))}}),r.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.password.message})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx(n,{className:"block mb-2 font-semibold text-black text-lg",text:s("confirmPassword.label")}),e.jsx(p,{id:"confirmPassword",type:"password",...o("confirmPassword",{required:s("confirmPassword.required"),validate:i=>i===x||s("confirmPassword.match")}),disabled:a,placeholder:"••••••",className:r.confirmPassword?"border-red-500":"border-gray-300",onChange:()=>{c&&m("confirmPassword")}}),r.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.confirmPassword.message})]}),e.jsx(S,{type:"submit",disabled:a,className:"w-full",children:s("submit")})]})};export{X as R};
