import{r as b,j as e}from"./iframe-U8ya4lKj.js";import{u as S}from"./index.esm-BbXu7aDV.js";import{V as v,b as y}from"./api-BNB6Hzxt.js";import{b as N,u as E}from"./index-DSF9hKFK.js";import{B as C}from"./Button-DE9W436l.js";import{u as V}from"./ButtonNavigation-COrRjsTF.js";import"./Dropdown-DwKt7Qhu.js";import"./FilePicker-CbYA0TGi.js";import"./GroupCover-BGBq_pSL.js";import{I as g}from"./Input-DaFUx77P.js";import"./Like-B3pHqG2f.js";import"./Loader-DiHYOjMw.js";import"./index-C84dbosL.js";import"./PageLoader-DRYwdG-o.js";import"./PageWrapper-CGXxUwgW.js";import"./PlayButton-DHaq6iyc.js";import{T as i}from"./Text-DVKAWUAM.js";import"./TrackControlButton-9SyhFgiT.js";import"./UserAvatar-QfRyJ_rf.js";import{u as k}from"./useTranslation-CSTQQmYg.js";const q=async o=>v.promise((async()=>{const s=await y.get("/users",{params:{email:o.email}});if(!s.data||s.data.length===0)throw new Error("Пользователь с таким email не найден");const t=s.data[0];if(!N.compareSync(o.password,t.password))throw new Error("Неверный пароль");const l=E.getState().setAuthData;return l(t),t})(),{loading:"Вход в систему...",success:"Вы успешно вошли",error:s=>s instanceof Error?s.message:"Ошибка при входе в систему"}).catch(()=>null),X=({onSuccess:o})=>{const{t:s}=k("loginForm"),t=V(),{register:m,handleSubmit:l,formState:{errors:a,isSubmitting:n,isSubmitted:d},trigger:p}=S({mode:"onSubmit"}),[c,x]=b.useState(""),[u,w]=b.useState(""),f=r=>{x(r),d&&p("email")},h=r=>{w(r),d&&p("password")},j=async()=>{await q({email:c,password:u})&&(o(),t("/main"))};return e.jsxs("form",{onSubmit:r=>{l(j)(r)},autoComplete:"off",noValidate:!0,children:[e.jsx(i,{title:s("title")}),e.jsxs("div",{className:"mb-6",children:[e.jsx(i,{className:"block mb-2 font-semibold text-black text-lg",text:s("email.label")}),e.jsx(g,{id:"email",type:"email",...m("email",{required:s("email.required"),pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:s("email.invalid")}}),value:c,onChangeHandler:f,disabled:n,placeholder:s("email.placeholder"),className:a.email?"border-red-500":"border-gray-300"}),a.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.email.message})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx(i,{className:"block mb-2 font-semibold text-black text-lg",text:s("password.label")}),e.jsx(g,{id:"password",type:"password",...m("password",{required:s("password.required"),minLength:{value:6,message:s("password.minLength")}}),value:u,onChangeHandler:h,disabled:n,placeholder:s("password.placeholder"),className:a.password?"border-red-500":"border-gray-300"}),a.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.password.message})]}),e.jsx(C,{type:"submit",disabled:n,className:"w-full",children:e.jsx(i,{text:s("submit")})})]})};export{X as L};
