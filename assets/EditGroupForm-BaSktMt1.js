import{r as g,u as v,j as e}from"./iframe-C0kfoYRU.js";import{u as y,C as j}from"./index.esm-CVV88-oh.js";import{V as C,e as N,g as S,a as b,G,h as E}from"./AutoHideScroll-Bn4kiatZ.js";import{B as f,a as I,b as z}from"./Button-BG29j6-m.js";import{u as F}from"./ButtonNavigation-AGHQnJJF.js";import"./Dropdown-B0nLrr0u.js";import"./FilePicker-BOxeBJkN.js";import{I as w}from"./Input-Syt8WR94.js";import"./Like-CU83MUjH.js";import"./Loader-BA1QRYy5.js";import"./index-CCh5LiNu.js";import"./PageLoader-CjR7aYj7.js";import"./PageWrapper-CUwEEPPt.js";import{T as m}from"./Text-Cv_jbED3.js";import"./TrackControlButton-Cp9njBny.js";import"./UserAvatar-D3VV5S8d.js";import{u as L}from"./useTranslation-DTQxaVaH.js";const T=async(r,a)=>{if(!r)throw new Error("ID группы не указан");return C.promise((async()=>{let s=a.cover;if(a.newIconFile?.[0]){const o=new FormData;o.append("groupName",a.name),o.append("icon",a.newIconFile[0]);const{data:u}=await N.post("/uploadGroupCover",o,{headers:{"Content-Type":"multipart/form-data"}});s=u.url}const i={name:a.name,description:a.description??null,genre:a.genre,cover:s,updatedAt:new Date().toISOString()},{data:l}=await S.patch(`/groups/${r}`,i);if(!l)throw new Error("Ошибка при обновлении группы");return b.getState().setCurrentGroup(l),l})(),{loading:"Сохраняем изменения...",success:"Группа успешно обновлена",error:s=>s instanceof Error?s.message:"Ошибка при обновлении группы"})},k=()=>{const r=b(t=>t.currentGroup),[a,s]=g.useState(null),{control:i,register:l,setValue:o,handleSubmit:u,watch:p,formState:{errors:x,isSubmitting:n}}=y({defaultValues:{name:"",description:"",genre:"Рок",icon:null}});g.useEffect(()=>{r&&(o("name",r.name),o("description",r.description??""),o("genre",r.genre??"Рок"),s(r.cover??null),o("icon",null))},[r,o]);const h=t=>{t?.[0]?(s(URL.createObjectURL(t[0])),o("icon",t)):(s(null),o("icon",null))},c=u(async t=>{if(!r)return!1;try{return await T(r.id,{name:t.name,description:t.description??null,genre:t.genre,cover:r.cover,newIconFile:t.icon??null}),!0}catch(d){return console.error("Ошибка обновления группы",d),!1}});return{control:i,register:l,errors:x,isSubmitting:n,preview:a,handleIconChange:h,onSubmit:c,setValue:o,watch:p}},Y=()=>{const r=v(c=>c.theme),{control:a,register:s,errors:i,isSubmitting:l,preview:o,handleIconChange:u,onSubmit:p}=k(),x=F(),{t:n}=L("editGroupForm"),h=()=>{p(),x("/my_group")};return e.jsxs("form",{className:"flex flex-col md:flex-row md:items-center md:justify-center gap-14 max-w-4xl p-6 rounded-lg max-h-[80vh] overflow-hidden mx-auto",children:[e.jsx(G,{edit:!0,preview:o,onIconChange:u}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-y-auto",style:{maxHeight:"80vh",minWidth:0},children:[e.jsx(m,{title:n("title"),className:"mb-4"}),e.jsx(m,{text:n("name.label"),size:"medium",className:"text-white"}),e.jsx(w,{...s("name",{required:n("name.required"),maxLength:{value:50,message:n("name.max")}}),placeholder:n("name.placeholder"),className:"bg-gray-700 border-gray-600 w-full min-w-0 mb-1"}),i.name&&e.jsx(m,{error:!0,size:"small",children:i.name.message}),e.jsx(m,{text:n("description.label"),size:"medium",className:"text-white mt-2"}),e.jsx(w,{...s("description",{maxLength:{value:200,message:n("description.max")}}),placeholder:n("description.placeholder"),className:"p-2 rounded bg-gray-700 border border-gray-600 text-white resize-none focus:outline-none focus:border-pink-600 w-full min-w-0 mb-4"}),i.description&&e.jsx(m,{error:!0,size:"small",children:i.description.message}),e.jsx(m,{text:n("genre.label"),size:"medium",className:"text-white mb-2"}),e.jsx(j,{control:a,name:"genre",rules:{required:n("genre.required")},render:({field:c})=>e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:E.map(t=>{const d=c.value===t;return e.jsx(f,{type:"button",onClick:()=>c.onChange(t),className:`transition-colors border rounded px-3 py-1 cursor-pointer select-none ${d?"text-white":"text-gray-300 hover:text-white"}`,style:{backgroundColor:d?r["--primary-color"]:"#2d2d2d",borderColor:d?r["--primary-color"]:"#4b5563"},children:t},t)})})}),i.genre&&e.jsx(m,{className:"text-red-500 text-sm mb-4",children:i.genre.message}),e.jsx(f,{type:"button",disabled:l,theme:z.OUTLINE,size:I.L,className:"self-center",onClick:h,children:n("submit")})]})]})};export{Y as E};
