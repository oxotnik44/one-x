import{j as c}from"./iframe-CCPG9B4X.js";import{B as C}from"./Button-Bbd_4dKP.js";import"./ButtonNavigation-BxvL78nb.js";import"./Dropdown-xaWiqvUd.js";import"./FilePicker-C-0viexR.js";import{c as w,a as b,g as d,e as j,d as v,b as h}from"./ConfirmDeleteModal-D2XLBDl3.js";import"./Input-CrW3eORU.js";import"./Like-B-_46ITe.js";import"./Loader-C1jWAQqW.js";import"./index-CBrGr1YP.js";import"./PageLoader-CcW8yQkr.js";import{P as R}from"./PageWrapper-B_RLjTmo.js";import"./Text-BdjnsNMI.js";import"./TrackControlButton-OZ2XJtMV.js";import"./UserAvatar-DMAIqh6G.js";import{g as S}from"./group-CAN1cVaR.js";import{u as k}from"./sidebarStore-BPjn5dKp.js";import"./classNames-DZENv8ZT.js";import"./clsx-B-dksMZM.js";import"./iconBase-BDT6FSQA.js";import"./useTranslation-CGIo-ki9.js";import"./Modal-fdBgQfJh.js";import"./index-C9vfmkzM.js";import"./index-DwxnaDBX.js";function y(e,t){return Math.floor(Math.random()*(t-e+1))+e}function x(){const e=Math.floor(100/S.length);return S.map(t=>({genre:t,percent:e}))}function U(e){const t=e.reduce((r,n)=>r+n.percent,0)||1;return e.map(r=>({genre:r.genre,percent:r.percent/t*100}))}function $(e){const t=e.reduce((o,a)=>o+a.percent,0),r=y(1,Math.floor(t));let n=0;for(const{genre:o,percent:a}of e)if(n+=a,r<=n)return o}function M(){const e=w.getState().authData;if(!e)throw new Error("Пользователь не авторизован");const t=b.getState().groups??[],r=new Set(t.map(a=>a.genre));let n=e.recommendation&&e.recommendation.length?e.recommendation:x();n=U(n).filter(a=>r.has(a.genre)),n.length||(n=x().filter(a=>r.has(a.genre)));let o;for(;!(o=$(n)););return o}async function N(){const e=M();if(e)try{const{data:t}=await d.get("/groups",{params:{genre:e}});if(!t.length)return;const r=[];for(const s of t){const{data:i}=await d.get("/tracks",{params:{groupId:s.id}});Array.isArray(i)&&i.length>0&&r.push(...i.map(g=>({...g,groupName:s.name,groupId:s.id})))}if(!r.length)return;const n=y(0,r.length-1),o=r[n];let a;if(o.albumId&&o.groupId){const{data:s}=await d.get("/albums",{params:{groupId:o.groupId}}),i=s.find(g=>g.id===o.albumId);i&&(a=i.name)}const I=a?`?albumName=${encodeURIComponent(a)}`:"",{data:m}=await j.get(`/trackInfo/${encodeURIComponent(o.groupName)}/${encodeURIComponent(o.title)}${I}`);if(!m.audioUrl||!m.coverUrl)return;const l={...o,cover:m.coverUrl,audioUrl:m.audioUrl};console.log(`[Рекомендации] Загружаем трек: "${o.title}" — ${o.groupName}${a?` (альбом: ${a})`:""}`),v.getState().setCurrentTrack(l);const f=h.getState().tracks;f?.some(s=>s.id===l.id)||h.getState().setTracks([...f,l])}catch(t){console.error("Ошибка при загрузке рекомендаций:",t)}}const P=()=>{const e=b(r=>r.setGroups),t=async()=>{try{const{data:r}=await d.get("/groups");e(r),N()}catch(r){console.error("Ошибка при загрузке данных",r)}};return c.jsx("div",{className:"p-4",children:c.jsx(C,{onClick:t,className:"px-6 py-3 rounded-2xl shadow-md",children:"Посмотреть рекомендации (консоль)"})})},T=()=>c.jsx(R,{children:c.jsx(P,{})}),ne={title:"pages/MainPage",component:T,decorators:[e=>(k.setState({isCollapsed:!1}),c.jsx("div",{style:{height:"100vh",backgroundColor:"#141414",padding:"1rem"},children:c.jsx(e,{})}))]},p={},u={decorators:[e=>(k.setState({isCollapsed:!0}),c.jsx(e,{}))]};p.parameters={...p.parameters,docs:{...p.parameters?.docs,source:{originalSource:"{}",...p.parameters?.docs?.source}}};u.parameters={...u.parameters,docs:{...u.parameters?.docs,source:{originalSource:`{
  decorators: [Story => {
    useSidebarStore.setState({
      isCollapsed: true
    });
    return <Story />;
  }]
}`,...u.parameters?.docs?.source}}};const se=["Default","SidebarCollapsed"];export{p as Default,u as SidebarCollapsed,se as __namedExportsOrder,ne as default};
